---
import DocsLayout from "../../../layouts/DocsLayout.astro";
import ApiEndpoint from "../../../components/ApiEndpoint.astro";
import Card from "../../../components/Card.astro";
import CodeBlock from "../../../components/CodeBlock.astro";
import FieldsTable from "../../../components/FieldsTable.astro";

const title = "Consulta de Documentos Tributarios";
const description =
  "Documentación para consultar Documentos Tributarios Electrónicos (DTE)";

// baseURL correcto para GitHub Pages
const baseURL = "/doc-api-facturacion-sv/";
---

<DocsLayout
  title={title}
  description={description}
  currentPage="/docs/api/consult-dte"
>
  <div class="prose prose-indigo dark:prose-invert max-w-none">
    <h1>{title}</h1>
    <p class="lead text-xl">
      Esta sección describe cómo consultar Documentos Tributarios Electrónicos
      (DTE) en el sistema de facturación electrónica.
    </p>

    <div class="not-prose my-8">
      <Card
        title="Autenticación requerida"
        type="warning"
        description="Todos los endpoints requieren autenticación mediante token JWT. Consulta la sección de Autenticación para más detalles."
        href={`${baseURL}docs/api/authentication`}
      />
    </div>

    <h2>Consultar DTE por ID</h2>

    <ApiEndpoint
      method="GET"
      endpoint="/api/v1/dte/{id}"
      description="Recupera un documento tributario electrónico por su código de generación"
      responseExample={`{
  "success": true,
  "data": {
    "identificacion": {
      "version": 1,
      "ambiente": "00",
      "tipoDte": "01",
      "numeroControl": "DTE-01-C0020000-000000000000001",
      "codigoGeneracion": "BC3F4F6F-C16D-4...",
      "tipoModelo": 1,
      "tipoOperacion": 1,
      "fecEmi": "2025-04-12",
      "horEmi": "19:35:06",
      "tipoMoneda": "USD"
    },
    "emisor": {
      "nit": "00000000000000",
      "nrc": "0000000",
      "nombre": "EMPRESA DE PRUEBAS SA DE CV",
      "codActividad": "00000",
      "descActividad": "Venta al por mayor de otros productos",
      "nombreComercial": "EJEMPLO",
      "tipoEstablecimiento": "01"
    },
    "receptor": {
      "nombre": "CLIENTE DE PRUEBA",
      "tipoDocumento": "13",
      "numDocumento": "00000000-0"
    },
    "resumen": {
      "totalGravada": 100.05,
      "totalIva": 11.51,
      "subTotal": 100.05,
      "totalPagar": 99.05,
      "totalLetras": "NOVENTA Y NUEVE 05/100",
      "condicionOperacion": 1
    },
    "estado": "RECIBIDO",
    "fechaEmision": "2025-04-12T19:35:06Z",
    "documentoRelacionado": null,
    "cuerpoDocumento": [
      // Lista de ítems del documento
    ]
  }
}`}
    >
      <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
        Este endpoint permite recuperar la información completa de un documento
        tributario electrónico mediante su código de generación (UUID).
      </p>
    </ApiEndpoint>

    <h2>Listar Documentos</h2>

    <ApiEndpoint
      method="GET"
      endpoint="/api/v1/dte"
      description="Lista todos los documentos tributarios con posibilidad de filtrado"
      responseExample={`{
  "success": true,
  "data": {
    "documents": [
      {
        "codigoGeneracion": "AB12CD34-5678-90EF-GHIJ-KLMNOPQRSTUV",
        "tipoDte": "01",
        "numeroControl": "DTE-01-C0020000-000000000000123",
        "fechaEmision": "2025-04-10T14:30:22Z",
        "nombre": "CLIENTE DE PRUEBA",
        "totalPagar": 125.50,
        "estado": "RECIBIDO"
      },
      // Más documentos...
    ],
    "summary": {
      "total": 104,
      "received": 63,
      "invalid": 8,
      "rejected": 33,
      "pending": 0,
      "by_contingency": 57,
      "by_normal": 47
    },
    "pagination": {
      "total_pages": 21,
      "page": 1,
      "page_size": 5
    }
  }
}`}
    >
      <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
        Este endpoint devuelve una lista paginada de documentos tributarios
        electrónicos. Puedes filtrar por tipo, estado, fecha, etc.
      </p>

      <FieldsTable
        title="Parámetros de consulta"
        description="Parámetros que pueden usarse para filtrar la lista de documentos"
        fields={[
          {
            name: "startDate",
            type: "string",
            description: "Fecha inicial en formato YYYY-MM-DD",
            required: false,
          },
          {
            name: "endDate",
            type: "string",
            description: "Fecha final en formato YYYY-MM-DD",
            required: false,
          },
          {
            name: "status",
            type: "string",
            description:
              "Estado del documento (RECEIVED, PENDING, REJECTED, INVALIDATED)",
            required: false,
          },
          {
            name: "type",
            type: "string",
            description:
              "Tipo de documento (01: Factura, 03: CCF, 05: Nota de Crédito, etc.)",
            required: false,
          },
          {
            name: "page",
            type: "integer",
            description: "Número de página para paginación",
            required: false,
          },
          {
            name: "page_size",
            type: "integer",
            description: "Cantidad de documentos por página (máx. 100)",
            required: false,
          },
        ]}
      />
    </ApiEndpoint>

  </div>
</DocsLayout>

